<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BowBlack â€” Early Access Waitlist</title>
  <meta name="description" content="Join the BowBlack early access waitlist and be first to try our smarter market-moves app." />
  <style>
    :root { --bg:#0b0b0c; --panel:#141416; --border:#26272b; --text:#e6e6e6; --muted:#9aa0a6; --brand:#4f46e5; --ok:#7ee787; --err:#ef4444; }
    *{box-sizing:border-box}
    body{margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); display:grid; min-height:100svh; place-items:center; padding:24px}
    .card{background:var(--panel); border:1px solid var(--border); width:min(92vw, 520px); padding:28px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px; font-size:28px}
    p{margin:0; color:var(--muted)}
    form{display:flex; gap:8px; margin-top:16px}
    input[type=email]{flex:1; padding:12px 14px; border-radius:10px; border:1px solid var(--border); background:#0e0f11; color:var(--text); outline:none}
    input[type=email]::placeholder{color:#6b7280}
    button{padding:12px 16px; border-radius:10px; border:0; background:var(--brand); color:white; font-weight:600; cursor:pointer}
    button:disabled{opacity:.65; cursor:not-allowed}
    .msg{margin-top:12px; font-size:14px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .fineprint{margin-top:10px; font-size:12px; color:#6b7280}
    .hp{position:absolute; left:-99999px; width:1px; height:1px; overflow:hidden} /* honeypot */
  </style>
</head>
<body>
  <div class="card" role="region" aria-label="Join the BowBlack waitlist">
    <h1>Get Early Access to BowBlack</h1>
    <p>Join the waitlist and be first to try our smarter market-moves app.</p>

   <form id="waitlistForm" novalidate>
  <input id="email" type="email" name="email" placeholder="you@example.com" autocomplete="email" required />
  <div id="emailError" role="alert" aria-live="polite" style="color:#c62828;font-size:14px;margin-top:4px;"></div>
  
  <button id="btn" type="submit" aria-label="Join waitlist">Join</button>
  <!-- Honeypot (blocks basic bots) -->
  <input class="hp" type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
</form>


    <div class="msg" id="msg" role="status" aria-live="polite"></div>
    <div class="fineprint">Weâ€™ll only use your email for launch updates.</div>
  </div>

  <script>
  <script>
  const FORM = document.getElementById('waitlistForm');
  const MSG  = document.getElementById('msg');
  const BTN  = document.getElementById('btn');
  const EMAIL = document.getElementById('email');
  const EMAIL_ERR = document.getElementById('emailError');

  // Your deployed Google Apps Script Web App (exec) URL:
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbxZzzSVsJ7ZUXdO_41Ta7n0iwffutAD_jaN9HIDMDP94kH-aWY8IGshkd3SUEB4Ei3Kiw/exec';

  // --- Email validation helpers ---
  const COMMON_DOMAIN_FIXES = {
    'gamil.com':'gmail.com','gmial.com':'gmail.com','gnail.com':'gmail.com','gmaill.com':'gmail.com','gmai.com':'gmail.com',
    'hotnail.com':'hotmail.com','hotmai.com':'hotmail.com','homtail.com':'hotmail.com',
    'yahho.com':'yahoo.com','yhoo.com':'yahoo.com','yahoo.co':'yahoo.com',
    'outlok.com':'outlook.com','outllok.com':'outlook.com',
    'icloud.co':'icloud.com','protonmaill.com':'proton.me','protonmail.co':'proton.me'
  };

  function showEmailError(msg) { EMAIL_ERR.textContent = msg || ''; }
  function clearEmailError() { showEmailError(''); }

  // Basic Levenshtein (small, just for short domain strings)
  function distance(a,b){
    a=a.toLowerCase(); b=b.toLowerCase();
    const dp=Array(b.length+1).fill(0).map((_,i)=>[i]);
    for(let j=0;j<=a.length;j++) dp[0][j]=j;
    for(let i=1;i<=b.length;i++){
      for(let j=1;j<=a.length;j++){
        dp[i][j]=Math.min(
          dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+(a[j-1]===b[i-1]?0:1)
        );
      }
    }
    return dp[b.length][a.length];
  }

  const POPULAR = ['gmail.com','hotmail.com','outlook.com','yahoo.com','icloud.com','live.com','proton.me'];

  function suggestDomain(domain){
    if (COMMON_DOMAIN_FIXES[domain]) return COMMON_DOMAIN_FIXES[domain];
    let best = null, bestD = 3; // max 2 edits away
    for (const good of POPULAR){
      const d = distance(domain, good);
      if (d < bestD){ bestD = d; best = good; }
    }
    return best;
  }

  function validEmailFormat(v){
    // overall length
    if (!v || v.length > 254) return { ok:false, msg:'Please enter a valid email address.' };

    // must be exactly one "@"
    const parts = v.split('@');
    if (parts.length !== 2) return { ok:false, msg:'Email must contain a single @ symbol.' };

    const [local, domainRaw] = parts;
    const domain = domainRaw.toLowerCase();

    // local part
    if (!local || local.length > 64) return { ok:false, msg:'Local part is too long.' };
    if (local.startsWith('.') || local.endsWith('.')) return { ok:false, msg:'Local part cannot start/end with a dot.' };
    if (/\.\./.test(local)) return { ok:false, msg:'Local part cannot contain consecutive dots.' };
    // allow common ASCII email characters
    if (!/^[A-Za-z0-9!#$%&'*+/=?^_`{|}~.-]+$/.test(local)) {
      return { ok:false, msg:'Local part contains invalid characters.' };
    }

    // domain part
    if (!domain || domain.length < 3) return { ok:false, msg:'Domain is too short.' };
    if (domain.startsWith('-') || domain.endsWith('-')) return { ok:false, msg:'Domain cannot start/end with a hyphen.' };
    if (/\.\./.test(domain)) return { ok:false, msg:'Domain cannot contain consecutive dots.' };
    if (!domain.includes('.')) return { ok:false, msg:'Domain must include a dot (e.g., gmail.com).' };

    // each label rules
    const labels = domain.split('.');
    for (const lbl of labels){
      if (!lbl.length) return { ok:false, msg:'Domain has empty label.' };
      if (!/^[A-Za-z0-9-]+$/.test(lbl)) return { ok:false, msg:'Domain contains invalid characters.' };
      if (lbl.startsWith('-') || lbl.endsWith('-')) return { ok:false, msg:'Domain labels cannot start/end with a hyphen.' };
    }

    // TLD length (2â€“63) and letters/digits allowed (keep simple)
    const tld = labels[labels.length-1];
    if (tld.length < 2 || tld.length > 63) return { ok:false, msg:'Top-level domain length is invalid.' };

    // If we got here, format looks good
    const suggestion = suggestDomain(domain);
    return { ok:true, suggestion };
  }

  // Live validation feedback
  EMAIL.addEventListener('input', () => {
    const v = EMAIL.value.trim();
    if (!v){ clearEmailError(); return; }
    const { ok, msg, suggestion } = validEmailFormat(v);
    if (!ok){ showEmailError(msg); return; }
    // show suggestion if domain looks mistyped
    const dom = v.split('@')[1]?.toLowerCase();
    if (suggestion && dom && suggestion !== dom){
      showEmailError(`Did you mean ${v.split('@')[0]}@${suggestion}? (Submit will still work)`);
    } else {
      clearEmailError();
    }
  });

  FORM.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = EMAIL.value.trim().toLowerCase();
    const trap  = document.getElementById('website').value; // honeypot

    if (trap) return; // bots only

    const { ok, msg } = validEmailFormat(email);
    if (!ok){
      showEmailError(msg || 'Please enter a valid email address.');
      return;
    }
    clearEmailError();

    BTN.disabled = true;
    MSG.textContent = 'Adding you to the list...';
    MSG.className = 'msg';

    try {
      // Submit as x-www-form-urlencoded to Apps Script
      const params = new URLSearchParams();
      params.append('email', email);
      params.append('source', 'waitlist_site');

      const res = await fetch(ENDPOINT, { method: 'POST', body: params });
      const text = await res.text();
      let data = {};
      try { data = JSON.parse(text); } catch { data = { ok:false, error:'Bad response' }; }

      if (data.ok) {
        MSG.textContent = 'Youâ€™re in! Check your email for confirmation ðŸŽ‰';
        MSG.className = 'msg ok';
        FORM.reset();
        clearEmailError();
      } else {
        throw new Error(data.error || 'Something went wrong');
      }
    } catch (err) {
      MSG.textContent = 'Sorry, there was an error. Please try again in a moment.';
      MSG.className = 'msg err';
    } finally {
      BTN.disabled = false;
    }
  });
</script>

  </script>
</body>
</html>
