<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BowBlack â€” Early Access Waitlist</title>
  <meta name="description" content="Join the BowBlack early access waitlist and be first to try our smarter market-moves app." />
  <style>
    :root { --bg:#0b0b0c; --panel:#141416; --border:#26272b; --text:#e6e6e6; --muted:#9aa0a6; --brand:#4f46e5; --ok:#7ee787; --err:#ef4444; }
    *{box-sizing:border-box}
    body{margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); display:grid; min-height:100svh; place-items:center; padding:24px}
    .card{background:var(--panel); border:1px solid var(--border); width:min(92vw, 520px); padding:28px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px; font-size:28px}
    p{margin:0; color:var(--muted)}
    form{display:flex; gap:8px; margin-top:16px}
    input[type=email]{flex:1; padding:12px 14px; border-radius:10px; border:1px solid var(--border); background:#0e0f11; color:var(--text); outline:none}
    input[type=email]::placeholder{color:#6b7280}
    button{padding:12px 16px; border-radius:10px; border:0; background:var(--brand); color:white; font-weight:600; cursor:pointer}
    button:disabled{opacity:.65; cursor:not-allowed}
    .msg{margin-top:12px; font-size:14px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .fineprint{margin-top:10px; font-size:12px; color:#6b7280}
    .hp{position:absolute; left:-99999px; width:1px; height:1px; overflow:hidden} /* honeypot */
  </style>
</head>
<body>
  <div class="card" role="region" aria-label="Join the BowBlack waitlist">
    <h1>Get Early Access to BowBlack</h1>
    <p>Join the waitlist and be first to try our smarter market-moves app.</p>

   <form id="waitlistForm" novalidate>
  <input id="email" type="email" name="email" placeholder="you@example.com" autocomplete="email" required />
  <div id="emailError" role="alert" aria-live="polite" style="color:#c62828;font-size:14px;margin-top:4px;"></div>
  
  <button id="btn" type="submit" aria-label="Join waitlist">Join</button>
  <!-- Honeypot (blocks basic bots) -->
  <input class="hp" type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
</form>


    <div class="msg" id="msg" role="status" aria-live="polite"></div>
    <div class="fineprint">Weâ€™ll only use your email for launch updates.</div>
  </div>


 <script>
  const FORM = document.getElementById('waitlistForm');
  const MSG  = document.getElementById('msg');
  const BTN  = document.getElementById('btn');
  const EMAIL = document.getElementById('email');
  const EMAIL_ERR = document.getElementById('emailError');

  // Deployed Google Apps Script Web App (exec) URL:
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbz8XD8pFZNsbrJ_cjDowd3BtGBEmgwonqWWd3UGnzFdz6i_StHJ_FvXN4TNiDE-joTwGQ/exec';

  /* ---------------- Existing validation you had ---------------- */
  function validEmail(v) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
    const emailError = document.getElementById("emailError");
    if (!v || !emailPattern.test(v)) {
      emailError.textContent = "Please enter a valid email address.";
      return false;
    }
    emailError.textContent = "";
    return true;
  }

  /* ---------------- NEW: popular-domain typo guard ------------- */
  const POPULAR_DOMAINS = [
    'gmail.com','hotmail.com','outlook.com','live.com',
    'yahoo.com','icloud.com','proton.me','protonmail.com'
  ];

  const COMMON_DOMAIN_FIXES = {
    // Gmail
    'gamil.com':'gmail.com','gmial.com':'gmail.com','gnail.com':'gmail.com',
    'gmaill.com':'gmail.com','gmai.com':'gmail.com','gmail.co':'gmail.com',
    // Hotmail / Outlook / Live
    'hotnail.com':'hotmail.com','hotmai.com':'hotmail.com','hotsail.com':'hotmail.com',
    'outlok.com':'outlook.com','outllok.com':'outlook.com','outlook.co':'outlook.com',
    'lvie.com':'live.com',
    // Yahoo / iCloud / Proton
    'yahho.com':'yahoo.com','yhoo.com':'yahoo.com','yahoo.co':'yahoo.com',
    'icloud.co':'icloud.com','protonmaill.com':'protonmail.com','protonmail.co':'protonmail.com'
  };

  // Small Levenshtein for near-miss detection
  function lev(a,b){
    a=a.toLowerCase(); b=b.toLowerCase();
    const dp = Array(b.length+1).fill(0).map((_,i)=>[i]);
    for (let j=0;j<=a.length;j++) dp[0][j]=j;
    for (let i=1;i<=b.length;i++){
      for (let j=1;j<=a.length;j++){
        dp[i][j]=Math.min(
          dp[i-1][j]+1,
          dp[i][j-1]+1,
          dp[i-1][j-1]+(a[j-1]===b[i-1]?0:1)
        );
      }
    }
    return dp[b.length][a.length];
  }

  function popularDomainGuard(email){
    const [local, rawDomain] = email.split('@');
    const domain = (rawDomain || '').toLowerCase();

    // exact popular domain â†’ OK
    if (POPULAR_DOMAINS.includes(domain)) return { ok:true };

    // known common typos â†’ suggest correct domain
    if (COMMON_DOMAIN_FIXES[domain]) {
      const fix = COMMON_DOMAIN_FIXES[domain];
      return { ok:false, msg:`Did you mean ${local}@${fix}? Please correct your email.` };
    }

    // near-miss (edit distance â‰¤ 2) to any popular domain â†’ likely typo
    let best = null, bestD = 3;
    for (const good of POPULAR_DOMAINS){
      const d = lev(domain, good);
      if (d < bestD){ bestD = d; best = good; }
    }
    if (best && bestD <= 2){
      return { ok:false, msg:`Did you mean ${local}@${best}? Please correct your email.` };
    }

    // otherwise (company/university domains) â†’ allow
    return { ok:true };
  }

  // Clear inline error while typing (kept minimal)
  EMAIL.addEventListener('input', () => { EMAIL_ERR.textContent = ''; });

  /* ---------------- Submit handler (unchanged except for new guard) ---------------- */
  FORM.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value.trim().toLowerCase();
    const trap  = document.getElementById('website').value; // honeypot
    if (trap) return; // bots only

    // your existing format check
    if (!validEmail(email)) {
      document.getElementById("emailError").textContent = "Please enter a valid email.";
      return;
    } else {
      document.getElementById("emailError").textContent = "";
    }

    // NEW: block common/near-miss typos for popular providers
    const guard = popularDomainGuard(email);
    if (!guard.ok){
      EMAIL_ERR.textContent = guard.msg;
      return;
    }

    BTN.disabled = true;
    MSG.textContent = 'Adding you to the list...';
    MSG.className = 'msg';

    try {
      const params = new URLSearchParams();
      params.append('email', email);
      params.append('source', 'waitlist_site');

      const res  = await fetch(ENDPOINT, { method: 'POST', body: params });
      const text = await res.text();
      let data = {};
      try { data = JSON.parse(text); } catch { data = { ok:false, error:'Bad response' }; }

      if (data.ok) {
        MSG.textContent = 'Youâ€™re in! Check your email for confirmation ðŸŽ‰';
        MSG.className = 'msg ok';
        FORM.reset();
      } else {
        throw new Error(data.error || 'Something went wrong');
      }
    } catch (err) {
      MSG.textContent = 'Sorry, there was an error. Please try again in a moment.';
      MSG.className = 'msg err';
    } finally {
      BTN.disabled = false;
    }
  });
</script>

</body>
</html>
