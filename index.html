<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BowBlack ‚Äî Early Access Waitlist</title>
  <meta name="description" content="Join the BowBlack early access waitlist and be first to try our smarter market-moves app." />
  <style>
    :root { --bg:#0b0b0c; --panel:#141416; --border:#26272b; --text:#e6e6e6; --muted:#9aa0a6; --brand:#4f46e5; --ok:#7ee787; --err:#ef4444; }
    *{box-sizing:border-box}
    body{margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); display:grid; min-height:100svh; place-items:center; padding:24px}
    .card{background:var(--panel); border:1px solid var(--border); width:min(92vw, 520px); padding:28px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px; font-size:28px}
    p{margin:0; color:var(--muted)}
    form{display:flex; gap:8px; margin-top:16px}
    input[type=email]{flex:1; padding:12px 14px; border-radius:10px; border:1px solid var(--border); background:#0e0f11; color:var(--text); outline:none}
    input[type=email]::placeholder{color:#6b7280}
    button{padding:12px 16px; border-radius:10px; border:0; background:var(--brand); color:white; font-weight:600; cursor:pointer}
    button:disabled{opacity:.65; cursor:not-allowed}
    .msg{margin-top:12px; font-size:14px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .fineprint{margin-top:10px; font-size:12px; color:#6b7280}
    .hp{position:absolute; left:-99999px; width:1px; height:1px; overflow:hidden} /* honeypot */
  </style>
</head>
<body>
  <div class="card" role="region" aria-label="Join the BowBlack waitlist">
    <h1>Get Early Access to BowBlack</h1>
    <p>Join the waitlist and be first to try our smarter market-moves app.</p>

   <form id="waitlistForm" novalidate>
  <input id="email" type="email" name="email" placeholder="you@example.com" autocomplete="email" required />
  <div id="emailError" role="alert" aria-live="polite" style="color:#c62828;font-size:14px;margin-top:4px;"></div>
  
  <button id="btn" type="submit" aria-label="Join waitlist">Join</button>
  <!-- Honeypot (blocks basic bots) -->
  <input class="hp" type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
</form>


    <div class="msg" id="msg" role="status" aria-live="polite"></div>
    <div class="fineprint">We‚Äôll only use your email for launch updates.</div>
  </div>

  <script>
  const FORM = document.getElementById('waitlistForm');
  const MSG  = document.getElementById('msg');
  const BTN  = document.getElementById('btn');
  const EMAIL = document.getElementById('email');
  const EMAIL_ERR = document.getElementById('emailError');

  // ‚õ≥Ô∏è Your deployed Apps Script Web App (EXEC) URL:
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbybegoGiV0lOwjxVYBCkbh9QyNiYdlKb8b0WeMRtBmBAo9Dqd4S5Mlyem2rsW6FbIienw/exec';

  function showEmailError(msg){ EMAIL_ERR.textContent = msg || ''; }
  function clearEmailError(){ showEmailError(''); }

  // Pragmatic email format check
  function validEmailFormat(v){
    if (!v) return {ok:false, msg:'Please enter a valid email address.'};
    if (v.length > 254) return {ok:false, msg:'Email is too long.'};
    const parts = v.split('@');
    if (parts.length !== 2) return {ok:false, msg:'Email must contain a single @ symbol.'};
    const [local, domain] = parts;
    if (!local || !domain) return {ok:false, msg:'Email must have text before and after @.'};
    if (!domain.includes('.')) return {ok:false, msg:'Domain must include a dot (e.g., gmail.com).'};
    // reasonable characters
    if (!/^[A-Za-z0-9!#$%&'*+/=?^_`{|}~.-]+$/.test(local)) return {ok:false, msg:'Local part has invalid characters.'};
    if (/\.\./.test(local)) return {ok:false, msg:'Local part cannot contain consecutive dots.'};
    if (!/^[A-Za-z0-9.-]+$/.test(domain)) return {ok:false, msg:'Domain has invalid characters.'};
    if (/\.\./.test(domain)) return {ok:false, msg:'Domain cannot contain consecutive dots.'};
    return {ok:true};
  }

  EMAIL.addEventListener('input', () => {
    const v = EMAIL.value.trim();
    if (!v) return clearEmailError();
    const {ok, msg} = validEmailFormat(v);
    if (!ok) showEmailError(msg); else clearEmailError();
  });

  FORM.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = EMAIL.value.trim().toLowerCase();
    const trap  = document.getElementById('website').value; // honeypot

    // bot trap
    if (trap) return;

    // format check
    const {ok, msg} = validEmailFormat(email);
    if (!ok){ showEmailError(msg); return; }
    clearEmailError();

    // UI lock
    BTN.disabled = true;
    MSG.textContent = 'Adding you to the list...';
    MSG.className = 'msg';

    try {
      // Submit as application/x-www-form-urlencoded (avoids CORS preflight with Apps Script)
      const params = new URLSearchParams();
      params.append('email', email);
      params.append('source', 'waitlist_site');

      const res = await fetch(ENDPOINT, { method: 'POST', body: params });
      const text = await res.text();

      let data;
      try { data = JSON.parse(text); }
      catch (e) {
        console.error('Non-JSON response from Apps Script:', text);
        throw new Error('Bad response');
      }

      if (!data.ok) throw new Error(data.error || 'Server error');

      if (data.duplicate) {
        MSG.textContent = 'Looks like you‚Äôre already on the list with that email ‚úîÔ∏è';
        MSG.className = 'msg ok';
      } else {
        MSG.textContent = 'You‚Äôre in! Check your email for confirmation üéâ';
        MSG.className = 'msg ok';
        FORM.reset();
        clearEmailError();
      }
    } catch (err) {
      console.error(err);
      MSG.textContent = 'Sorry, there was an error. Please try again in a moment.';
      MSG.className = 'msg err';
    } finally {
      BTN.disabled = false;
    }
  });

  </script>
</body>
</html>
